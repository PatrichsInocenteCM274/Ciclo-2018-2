
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	C:\Software_CC212_arquitectura\lab3_dirigido\primera_pregLab3_i.asm
	Object File:	C:\Software_CC212_arquitectura\lab3_dirigido\primera_pregLab3_i.hex
	List File:	C:\Software_CC212_arquitectura\lab3_dirigido\primera_pregLab3_i.lst



 Line  I  Addr  Code            Source

    1:				;Hacer un programa para el TMC51 para seleccionar una frecuencia de
    2:				;2hz, 12hz, 22hz y 32h de tal manera que enviando un “01” por el
    3:				;puerto serie seleccione una frecuencia de 2
    4:				;hertz, enviando un “02” seleccione 12 hertz,
    5:				;enviando “03” seleccione 22 hertz y
    6:				;enviando “04” seleccione 32 hertz. La señal saldrá por el pin P1.0
    7:				;del Puerto 1.Sugerencia: Usar el timer 0 en modo 0.
    8:
    9:		N      010C	break     equ  010ch  ; a, (lee acumulador)
   10:		N      012A	inkey     equ  012ah  ; a
   11:		N      0115	crlf      equ  115h
   12:		N      02F0	endloop   equ  2f0h
   13:		N      0136	print     equ  136h
   14:		N      011E	getbyt    equ  11eh
   15:		N      0145	setintvec equ  145h
   16:		N      8000	          org       8000h    ;El programa empieza en esta direcci¢n de
   17:				                             ;de memoria
   18:
   19:	  8000			ejemplo:
   20:	  8000	12 01 36	          lcall     print   ;PRINT es una subrutina grabado en el FlashRom
   21:				                            ;se usa para imprimir mensajes en el terminal de la PC.
   22:	  8003	0D 0A 20 4D	          db        0dh,0ah," M E N U "
	  8007	20 45 20 4E
	  800B	20 55 20
   23:	  800E	0D 0A 3D 3D	          db        0dh,0ah,"=========",0dh,0ah
	  8012	3D 3D 3D 3D
	  8016	3D 3D 3D 0D
	  801A	0A
   24:	  801B	0D 0A 20 48	          db        0dh,0ah," HECHO POR: C. Martin Cruz Salazar",0dh,0ah
	  801F	45 43 48 4F
	  8023	20 50 4F 52
	  8027	3A 20 43 2E
	  802B	20 4D 61 72
	  802F	74 69 6E 20
	  8033	43 72 75 7A
	  8037	20 53 61 6C
	  803B	61 7A 61 72
	  803F	0D 0A
   25:	  8041	0D 0A 20 30	          db        0dh,0ah," 01) FRECUENCIA: 2 HZ"
	  8045	31 29 20 46
	  8049	52 45 43 55
	  804D	45 4E 43 49
	  8051	41 3A 20 32

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

	  8055	20 48 5A
   26:	  8058	0D 0A 20 30	          db        0dh,0ah," 02) FRECUENCIA: 12 HZ"
	  805C	32 29 20 46
	  8060	52 45 43 55
	  8064	45 4E 43 49
	  8068	41 3A 20 31
	  806C	32 20 48 5A
   27:	  8070	0D 0A 20 30	          db        0dh,0ah," 03) FRECUENCIA: 22 HZ",0dh,0ah
	  8074	33 29 20 46
	  8078	52 45 43 55
	  807C	45 4E 43 49
	  8080	41 3A 20 32
	  8084	32 20 48 5A
	  8088	0D 0A
   28:	  808A	0D 0A 20 53	          db        0dh,0ah," Seleccione numero hexadecimal: ",0
	  808E	65 6C 65 63
	  8092	63 69 6F 6E
	  8096	65 20 6E 75
	  809A	6D 65 72 6F
	  809E	20 68 65 78
	  80A2	61 64 65 63
	  80A6	69 6D 61 6C
	  80AA	3A 20 00
   29:	  80AD	12 01 1E	          lcall     getbyt
   30:	  80B0	B4 01 02	          cjne      a,#1h,salir
   31:	  80B3	80 03		          sjmp      frec2hz
   32:	  80B5			salir:
   33:	  80B5	02 81 48	          ljmp      otrafrecuencia
   34:
   35:	  80B8			frec2hz:
   36:	  80B8	12 01 36		  lcall     print
   37:	  80BB	0D 0A 46 52	          db       0dh,0ah,"FRECUENCIA SELECCIONADA: 2Hz"
	  80BF	45 43 55 45
	  80C3	4E 43 49 41
	  80C7	20 53 45 4C
	  80CB	45 43 43 49
	  80CF	4F 4E 41 44
	  80D3	41 3A 20 32
	  80D7	48 7A
   38:	  80D9	0D 0A 3D 3D	          db       0dh,0ah,"==============================",0dh,0ah,0h
	  80DD	3D 3D 3D 3D
	  80E1	3D 3D 3D 3D
	  80E5	3D 3D 3D 3D
	  80E9	3D 3D 3D 3D
	  80ED	3D 3D 3D 3D
	  80F1	3D 3D 3D 3D
	  80F5	3D 3D 3D 3D
	  80F9	0D 0A 00
   39:	  80FC	75 89 20	          mov TMOD,#20h		;configura el timer 0 en modo 0
   40:								; como un temporizador de 13 bits
   41:	  80FF	74 01		          mov a, #1 ; Timer 0 es la fuente de interrupción
   42:	  8101	90 82 11		  mov dptr, #f2hz ; f2hz es la dirección inicial del ISR
   43:	  8104	12 01 45		  lcall setintvec ;Posibilita tener el ISR en RAM
   44:	  8107	75 8C 00		  mov TH0,#0
   45:	  810A	75 8A 00		  mov TL0,#0		;
   46:	  810D	D2 8C			  setb TR0		;inicia el timer 0

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

   47:	  810F	D2 A9			  Setb ET0 ; habilita interrupción del timer 0
   48:	  8111	D2 AF		          Setb EA ; habilita interrupción global
   49:	  8113	7F 1C			  mov R7,#28		;contador
   50:	  8115			loop:
   51:	  8115	BF 00 28		  cjne R7,#0,va_fuera
   52:	  8118	B2 90			  cpl P1.0
   53:	  811A	12 01 36		  lcall print
   54:	  811D	0D 0A 74 72		  db 0dh,0ah, "trancurrio medio periodo",0
	  8121	61 6E 63 75
	  8125	72 72 69 6F
	  8129	20 6D 65 64
	  812D	69 6F 20 70
	  8131	65 72 69 6F
	  8135	64 6F 00
   55:	  8138	75 8C 00		  mov TH0,#0
   56:	  813B	75 8A 00		  mov TL0,#0
   57:	  813E	7F 1C			  mov R7,#28
   58:	  8140			va_fuera:
   59:	  8140	12 01 2A		  lcall inkey         ;
   60:	  8143	12 01 0C	 	  lcall break         ; termina programa si CTL-C
   61:	  8146	80 CD			  sjmp loop
   62:
   63:	  8148			otrafrecuencia:
   64:	  8148	B4 02 02		cjne      a,#2h,salir1
   65:	  814B	80 02		  	sjmp      frec12hz
   66:	  814D			salir1:
   67:	  814D	80 5D			sjmp otrafrecuencia1
   68:	  814F			frec12hz:
   69:	  814F	12 01 36		lcall     print
   70:	  8152	0D 0A 46 52	          db       0dh,0ah,"FRECUENCIA SELECCIONADA: 12Hz"
	  8156	45 43 55 45
	  815A	4E 43 49 41
	  815E	20 53 45 4C
	  8162	45 43 43 49
	  8166	4F 4E 41 44
	  816A	41 3A 20 31
	  816E	32 48 7A
   71:	  8171	0D 0A 3D 3D	          db       0dh,0ah,"==============================",0dh,0ah,0h
	  8175	3D 3D 3D 3D
	  8179	3D 3D 3D 3D
	  817D	3D 3D 3D 3D
	  8181	3D 3D 3D 3D
	  8185	3D 3D 3D 3D
	  8189	3D 3D 3D 3D
	  818D	3D 3D 3D 3D
	  8191	0D 0A 00
   72:	  8194	75 89 20		mov TMOD,#20h	;configura el timer 0 en modo 0
   73:							;como un temporizador de 13 bits
   74:	  8197	75 8C 00		mov TH0,#0
   75:	  819A	75 8A 00		mov TL0,#0
   76:	  819D	D2 8C			setb TR0	;inicia el timer 0
   77:	  819F	7F 05			mov R7,#5	;contador
   78:	  81A1			loop1:
   79:	  81A1	12 82 15		lcall f12hz
   80:	  81A4	12 01 2A		lcall inkey         ;
   81:	  81A7	12 01 0C	 	lcall break         ; termina programa si CTL-C

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

   82:	  81AA	80 F5			sjmp loop1
   83:	  81AC			otrafrecuencia1:
   84:	  81AC	B4 03 02		cjne      a,#3h,salir2
   85:	  81AF	80 03		  	sjmp      frec22hz
   86:	  81B1			salir2:
   87:	  81B1	02 02 F0		ljmp 2F0h
   88:	  81B4			frec22hz:
   89:	  81B4	12 01 36		lcall     print
   90:	  81B7	0D 0A 46 52	          db       0dh,0ah,"FRECUENCIA SELECCIONADA: 22Hz"
	  81BB	45 43 55 45
	  81BF	4E 43 49 41
	  81C3	20 53 45 4C
	  81C7	45 43 43 49
	  81CB	4F 4E 41 44
	  81CF	41 3A 20 32
	  81D3	32 48 7A
   91:	  81D6	0D 0A 3D 3D	          db       0dh,0ah,"==============================",0dh,0ah,0h
	  81DA	3D 3D 3D 3D
	  81DE	3D 3D 3D 3D
	  81E2	3D 3D 3D 3D
	  81E6	3D 3D 3D 3D
	  81EA	3D 3D 3D 3D
	  81EE	3D 3D 3D 3D
	  81F2	3D 3D 3D 3D
	  81F6	0D 0A 00
   92:	  81F9	75 89 20		mov TMOD,#20h		;configura el timer 0 en modo 0
   93:								; como un temporizador de 13 bits
   94:	  81FC	75 8C 00		mov TH0,#0
   95:	  81FF	75 8A 00		mov TL0,#0
   96:	  8202	D2 8C			setb TR0		;inicia el timer 0
   97:	  8204	7F 03			mov R7,#3		;contador
   98:	  8206			loop2:
   99:	  8206	12 82 21		lcall f22hz
  100:	  8209	12 01 2A		lcall inkey         ;
  101:	  820C	12 01 0C	 	lcall break         ; termina programa si CTL-C
  102:	  820F	80 F5			sjmp loop2
  103:
  104:
  105:	  8211			f2hz:
  106:	  8211	C2 8D			clr TF0		;este flag de desbordamiento se pone a 1 por hardware,
  107:							;este flag debe ser puesto a 0 por software
  108:	  8213	1F			dec R7
  109:	  8214	32			reti
  110:	  8215			f12hz:
  111:	  8215	30 8D FD		jnb TF0,$	;esto se repite mientras TF0 es cero y no hay
  112:							;desbordamiento
  113:	  8218	C2 8D			clr TF0		;este flag de desbordamiento se pone a 1 por hardware,
  114:							;este flag debe ser puesto a 0 por software
  115:	  821A	DF F9			djnz R7,f12hz	;
  116:	  821C	7F 05			mov R7,#5
  117:	  821E	B2 90			cpl P1.0
  118:	  8220	22			ret
  119:
  120:	  8221			f22hz:
  121:	  8221	30 8D FD		jnb TF0,$	;esto se repite mientras TF0 es cero y no hay
  122:	  8224	C2 8D			clr TF0		;este flag de desbordamiento se pone a 1 por hardware,

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  123:							;este flag debe ser puesto a 0 por software
  124:	  8226	DF F9			djnz R7,f22hz	;
  125:	  8228	7F 03			mov R7,#3
  126:	  822A	B2 90			cpl P1.0
  127:	  822C	C2 8D			clr TF0
  128:	  822E	22			ret
  129:					end
  130:





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
B				  DATA	      F0
BREAK				  NUMBER    010C	   9
CRLF				  NUMBER    0115	  11
CY				  BIT	      D7
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
EJEMPLO				  CODE	    8000	  19
ENDLOOP				  NUMBER    02F0	  12
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
F12HZ				  CODE	    8215	 110
F22HZ				  CODE	    8221	 120
F2HZ				  CODE	    8211	 105
FREC12HZ			  CODE	    814F	  68
FREC22HZ			  CODE	    81B4	  88
FREC2HZ				  CODE	    80B8	  35
GETBYT				  NUMBER    011E	  14
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INKEY				  NUMBER    012A	  10
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8
IT0				  BIT	      88
IT1				  BIT	      8A
LOOP				  CODE	    8115	  50
LOOP1				  CODE	    81A1	  78
LOOP2				  CODE	    8206	  98
OTRAFRECUENCIA			  CODE	    8148	  63
OTRAFRECUENCIA1			  CODE	    81AC	  83
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0
PCON				  DATA	      87
PRINT				  NUMBER    0136	  13

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PS				  BIT	      BC
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PX0				  BIT	      B8
PX1				  BIT	      BA
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SALIR				  CODE	    80B5	  32
SALIR1				  CODE	    814D	  66
SALIR2				  CODE	    81B1	  86
SBUF				  DATA	      99
SCON				  DATA	      98
SETINTVEC			  NUMBER    0145	  15
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SP				  DATA	      81
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
VA_FUERA			  CODE	    8140	  58
WR				  BIT	      B6
