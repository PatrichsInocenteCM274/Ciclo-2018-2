
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	C:\Software_CC212_arquitectura\lab3_dirigido_2018_II\p2_modificado.asm
	Object File:	C:\Software_CC212_arquitectura\lab3_dirigido_2018_II\p2_modificado.hex
	List File:	C:\Software_CC212_arquitectura\lab3_dirigido_2018_II\p2_modificado.lst



 Line  I  Addr  Code            Source

    1:				;Hacer un programa para el TMC51 que al presionar el botón conectado al pin P3.2
    2:				;interrumpa al TMC51 y en ese momento envié por el puerto serie dos cadenas: “curso:
    3:				;Arquitectura de Computadores” y en otra fila “Prof.: Martín Cruz”. El programa principal
    4:				;es un contador de 0 a F mostrado en el display de 7 segmentos.
    5:		N      0142	sdelay  equ 142h
    6:		N      013F	prthex  equ 13Fh
    7:		N      0148	sndchr  equ 148h
    8:		N      0145	setintvec equ 145h
    9:		N      0136	print   equ 136h
   10:		N      011B	display equ 11Bh
   11:		N      010C	break     equ  010ch  ; a, (lee acumulador)
   12:		N      012A	inkey     equ  012ah  ; a
   13:		N      0115	crlf      equ  115h
   14:		N      02F0	endloop   equ  2f0h
   15:		N      011E	getbyt    equ  11eh
   16:		N      8000		org 8000h
   17:	  8000	D2 88			setb IT0; fijamos la interrupcion externa sensible en el flanco de
   18:						; bajada.
   19:	  8002	74 00			mov A,#0
   20:	  8004	90 80 2C		mov dptr,#ISR0	;Muevo al registro DPTR una dirección de 16 bits
   21:	  8007	12 01 45		lcall setintvec
   22:	  800A	D2 A8			setb EX0
   23:	  800C	D2 AF			setb EA
   24:	  800E	D2 B2			setb P3.2
   25:	  8010			repite:
   26:	  8010	7B 00			mov R3,#0
   27:	  8012	7D 10			mov R5,#16	;R5 es mi contador
   28:	  8014			lazo:
   29:	  8014	EB			mov A,R3
   30:	  8015	12 01 3F		lcall prthex	;muestra el digito en el terminal
   31:	  8018	74 0D			mov A,#0dh	;retorno de carro
   32:	  801A	12 01 48		lcall sndchr
   33:	  801D	EB			mov A,R3
   34:	  801E	12 01 1B		lcall display	;codigo para el display
   35:	  8021	F4			cpl A		;invierte los bits
   36:	  8022	F5 90			mov P1,A	;envio al puerto P1
   37:	  8024	12 01 42		lcall sdelay	;tiempo de un segundo
   38:	  8027	0B			inc R3
   39:	  8028	DD EA			djnz R5,lazo
   40:	  802A	80 E4			sjmp repite
   41:				;Rutina de interrupcion
   42:	  802C			ISR0:
   43:	  802C	C0 E0			push acc	;Salva el valor del acumulador en la pila de la memoria

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44:	  802E	12 01 36		lcall     print   ;PRINT es una subrutina grabado en el FlashRom
   45:				                            ;se usa para imprimir mensajes en el terminal de la PC.
   46:	  8031	0D 0A 20 4D	          db        0dh,0ah," M E N U "
	  8035	20 45 20 4E
	  8039	20 55 20
   47:	  803C	0D 0A 3D 3D	          db        0dh,0ah,"=========",0dh,0ah
	  8040	3D 3D 3D 3D
	  8044	3D 3D 3D 0D
	  8048	0A
   48:	  8049	0D 0A 20 48	          db        0dh,0ah," HECHO POR: C. Martin Cruz Salazar",0dh,0ah
	  804D	45 43 48 4F
	  8051	20 50 4F 52
	  8055	3A 20 43 2E
	  8059	20 4D 61 72
	  805D	74 69 6E 20
	  8061	43 72 75 7A
	  8065	20 53 61 6C
	  8069	61 7A 61 72
	  806D	0D 0A
   49:	  806F	0D 0A 20 30	          db        0dh,0ah," 01) FRECUENCIA: 2 HZ"
	  8073	31 29 20 46
	  8077	52 45 43 55
	  807B	45 4E 43 49
	  807F	41 3A 20 32
	  8083	20 48 5A
   50:	  8086	0D 0A 20 30	          db        0dh,0ah," 02) FRECUENCIA: 12 HZ"
	  808A	32 29 20 46
	  808E	52 45 43 55
	  8092	45 4E 43 49
	  8096	41 3A 20 31
	  809A	32 20 48 5A
   51:	  809E	0D 0A 20 30	          db        0dh,0ah," 03) FRECUENCIA: 22 HZ",0dh,0ah
	  80A2	33 29 20 46
	  80A6	52 45 43 55
	  80AA	45 4E 43 49
	  80AE	41 3A 20 32
	  80B2	32 20 48 5A
	  80B6	0D 0A
   52:	  80B8	0D 0A 20 53	          db        0dh,0ah," Seleccione numero hexadecimal: ",0
	  80BC	65 6C 65 63
	  80C0	63 69 6F 6E
	  80C4	65 20 6E 75
	  80C8	6D 65 72 6F
	  80CC	20 68 65 78
	  80D0	61 64 65 63
	  80D4	69 6D 61 6C
	  80D8	3A 20 00
   53:	  80DB	12 01 1E	          lcall     getbyt
   54:				 	;lcall crlf	;retorno de carro y un salto de linea
   55:	  80DE	B4 01 02	          cjne      a,#1h,salir
   56:	  80E1	80 02		          sjmp      frec2hz
   57:	  80E3			salir:
   58:	  80E3	80 5C		          sjmp      otrafrecuencia
   59:
   60:	  80E5			frec2hz:
   61:	  80E5	12 01 36	          lcall     print

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

   62:	  80E8	0D 0A 46 52	          db       0dh,0ah,"FRECUENCIA SELECCIONADA: 2Hz"
	  80EC	45 43 55 45
	  80F0	4E 43 49 41
	  80F4	20 53 45 4C
	  80F8	45 43 43 49
	  80FC	4F 4E 41 44
	  8100	41 3A 20 32
	  8104	48 7A
   63:	  8106	0D 0A 3D 3D	          db       0dh,0ah,"==============================",0dh,0ah,0h
	  810A	3D 3D 3D 3D
	  810E	3D 3D 3D 3D
	  8112	3D 3D 3D 3D
	  8116	3D 3D 3D 3D
	  811A	3D 3D 3D 3D
	  811E	3D 3D 3D 3D
	  8122	3D 3D 3D 3D
	  8126	0D 0A 00
   64:	  8129	75 89 20	          mov TMOD,#20h		;configura el timer 0 en modo 0
   65:								; como un temporizador de 13 bits
   66:	  812C	75 8C 00		  mov TH0,#0
   67:	  812F	75 8A 00		  mov TL0,#0		;
   68:	  8132	D2 8C			  setb TR0		;inicia el timer 0
   69:	  8134	7F 1C			  mov R7,#28		;contador
   70:	  8136			loop:
   71:	  8136	12 82 0D		  lcall f2hz
   72:	  8139	12 01 2A		  lcall inkey         ;
   73:	  813C	12 01 0C	 	  lcall break         ; termina programa si CTL-C
   74:	  813F	80 F5			  sjmp loop
   75:	  8141			otrafrecuencia:
   76:	  8141	B4 02 02		cjne      a,#2h,salir1
   77:	  8144	80 02		  	sjmp      frec12hz
   78:	  8146			salir1:
   79:	  8146	80 5D			sjmp otrafrecuencia1
   80:	  8148			frec12hz:
   81:	  8148	12 01 36		lcall     print
   82:	  814B	0D 0A 46 52	          db       0dh,0ah,"FRECUENCIA SELECCIONADA: 12Hz"
	  814F	45 43 55 45
	  8153	4E 43 49 41
	  8157	20 53 45 4C
	  815B	45 43 43 49
	  815F	4F 4E 41 44
	  8163	41 3A 20 31
	  8167	32 48 7A
   83:	  816A	0D 0A 3D 3D	          db       0dh,0ah,"==============================",0dh,0ah,0h
	  816E	3D 3D 3D 3D
	  8172	3D 3D 3D 3D
	  8176	3D 3D 3D 3D
	  817A	3D 3D 3D 3D
	  817E	3D 3D 3D 3D
	  8182	3D 3D 3D 3D
	  8186	3D 3D 3D 3D
	  818A	0D 0A 00
   84:	  818D	75 89 20		mov TMOD,#20h	;configura el timer 0 en modo 0
   85:							;como un temporizador de 13 bits
   86:	  8190	75 8C 00		mov TH0,#0
   87:	  8193	75 8A 00		mov TL0,#0

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

   88:	  8196	D2 8C			setb TR0	;inicia el timer 0
   89:	  8198	7F 05			mov R7,#5	;contador
   90:	  819A			loop1:
   91:	  819A	12 82 19		lcall f12hz
   92:	  819D	12 01 2A		lcall inkey         ;
   93:	  81A0	12 01 0C	 	lcall break     ; termina programa si CTL-C
   94:	  81A3	80 F5			sjmp loop1
   95:	  81A5			otrafrecuencia1:
   96:	  81A5	B4 03 02		cjne      a,#3h,salir2
   97:	  81A8	80 03		  	sjmp      frec22hz
   98:	  81AA			salir2:
   99:	  81AA	02 02 F0		ljmp 2F0h
  100:	  81AD			frec22hz:
  101:	  81AD	12 01 36		lcall     print
  102:	  81B0	0D 0A 46 52	          db       0dh,0ah,"FRECUENCIA SELECCIONADA: 22Hz"
	  81B4	45 43 55 45
	  81B8	4E 43 49 41
	  81BC	20 53 45 4C
	  81C0	45 43 43 49
	  81C4	4F 4E 41 44
	  81C8	41 3A 20 32
	  81CC	32 48 7A
  103:	  81CF	0D 0A 3D 3D	          db       0dh,0ah,"==============================",0dh,0ah,0h
	  81D3	3D 3D 3D 3D
	  81D7	3D 3D 3D 3D
	  81DB	3D 3D 3D 3D
	  81DF	3D 3D 3D 3D
	  81E3	3D 3D 3D 3D
	  81E7	3D 3D 3D 3D
	  81EB	3D 3D 3D 3D
	  81EF	0D 0A 00
  104:	  81F2	75 89 20		mov TMOD,#20h		;configura el timer 0 en modo 0
  105:								; como un temporizador de 13 bits
  106:	  81F5	75 8C 00		mov TH0,#0
  107:	  81F8	75 8A 00		mov TL0,#0
  108:	  81FB	D2 8C			setb TR0		;inicia el timer 0
  109:	  81FD	7F 03			mov R7,#3		;contador
  110:	  81FF			loop2:
  111:	  81FF	12 82 25		lcall f22hz
  112:	  8202	12 01 2A		lcall inkey         ;
  113:	  8205	12 01 0C	 	lcall break         ; termina programa si CTL-C
  114:	  8208	80 F5			sjmp loop2
  115:	  820A	D0 E0			pop acc		;Retorno el valor de la pila al acumulador
  116:	  820C	32			reti
  117:	  820D			f2hz:
  118:	  820D	30 8D FD		jnb TF0,$	;esto se repite mientras TF0 es cero y no hay desbordamiento
  119:
  120:	  8210	C2 8D			clr TF0		;este flag de desbordamiento se pone a 1 por hardware,
  121:							;este flag debe ser puesto a 0 por software
  122:	  8212	DF F9			djnz R7,f2hz
  123:	  8214	7F 1C			mov R7,#28
  124:	  8216	B2 90			cpl P1.0
  125:	  8218	22			ret
  126:	  8219			f12hz:
  127:	  8219	30 8D FD		jnb TF0,$	;esto se repite mientras TF0 es cero y no hay
  128:							;desbordamiento

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  129:	  821C	C2 8D			clr TF0		;este flag de desbordamiento se pone a 1 por hardware,
  130:							;este flag debe ser puesto a 0 por software
  131:	  821E	DF F9			djnz R7,f12hz	;
  132:	  8220	7F 05			mov R7,#5
  133:	  8222	B2 90			cpl P1.0
  134:	  8224	22			ret
  135:
  136:	  8225			f22hz:
  137:	  8225	30 8D FD		jnb TF0,$	;esto se repite mientras TF0 es cero y no hay
  138:	  8228	C2 8D			clr TF0		;este flag de desbordamiento se pone a 1 por hardware,
  139:							;este flag debe ser puesto a 0 por software
  140:	  822A	DF F9			djnz R7,f22hz	;
  141:	  822C	7F 03			mov R7,#3
  142:	  822E	B2 90			cpl P1.0
  143:	  8230	C2 8D			clr TF0
  144:	  8232	22			ret
  145:					end





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6
ACC				  DATA	      E0
B				  DATA	      F0
BREAK				  NUMBER    010C	  11
CRLF				  NUMBER    0115	  13
CY				  BIT	      D7
DISPLAY				  NUMBER    011B	  10
DPH				  DATA	      83
DPL				  DATA	      82
EA				  BIT	      AF
ENDLOOP				  NUMBER    02F0	  14
ES				  BIT	      AC
ET0				  BIT	      A9
ET1				  BIT	      AB
EX0				  BIT	      A8
EX1				  BIT	      AA
EXTI0				  CODE	    0003
EXTI1				  CODE	    0013
F0				  BIT	      D5
F12HZ				  CODE	    8219	 126
F22HZ				  CODE	    8225	 136
F2HZ				  CODE	    820D	 117
FREC12HZ			  CODE	    8148	  80
FREC22HZ			  CODE	    81AD	 100
FREC2HZ				  CODE	    80E5	  60
GETBYT				  NUMBER    011E	  15
IE				  DATA	      A8
IE0				  BIT	      89
IE1				  BIT	      8B
INKEY				  NUMBER    012A	  12
INT0				  BIT	      B2
INT1				  BIT	      B3
IP				  DATA	      B8
ISR0				  CODE	    802C	  42
IT0				  BIT	      88
IT1				  BIT	      8A
LAZO				  CODE	    8014	  28
LOOP				  CODE	    8136	  70
LOOP1				  CODE	    819A	  90
LOOP2				  CODE	    81FF	 110
OTRAFRECUENCIA			  CODE	    8141	  75
OTRAFRECUENCIA1			  CODE	    81A5	  95
OV				  BIT	      D2
P				  BIT	      D0
P0				  DATA	      80
P1				  DATA	      90
P2				  DATA	      A0
P3				  DATA	      B0

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
PCON				  DATA	      87
PRINT				  NUMBER    0136	   9
PRTHEX				  NUMBER    013F	   6
PS				  BIT	      BC
PSW				  DATA	      D0
PT0				  BIT	      B9
PT1				  BIT	      BB
PX0				  BIT	      B8
PX1				  BIT	      BA
RB8				  BIT	      9A
RD				  BIT	      B7
REN				  BIT	      9C
REPITE				  CODE	    8010	  25
RESET				  CODE	    0000
RI				  BIT	      98
RS0				  BIT	      D3
RS1				  BIT	      D4
RXD				  BIT	      B0
SALIR				  CODE	    80E3	  57
SALIR1				  CODE	    8146	  78
SALIR2				  CODE	    81AA	  98
SBUF				  DATA	      99
SCON				  DATA	      98
SDELAY				  NUMBER    0142	   5
SETINTVEC			  NUMBER    0145	   8
SINT				  CODE	    0023
SM0				  BIT	      9F
SM1				  BIT	      9E
SM2				  BIT	      9D
SNDCHR				  NUMBER    0148	   7
SP				  DATA	      81
T0				  BIT	      B4
T1				  BIT	      B5
TB8				  BIT	      9B
TCON				  DATA	      88
TF0				  BIT	      8D
TF1				  BIT	      8F
TH0				  DATA	      8C
TH1				  DATA	      8D
TI				  BIT	      99
TIMER0				  CODE	    000B
TIMER1				  CODE	    001B
TL0				  DATA	      8A
TL1				  DATA	      8B
TMOD				  DATA	      89
TR0				  BIT	      8C
TR1				  BIT	      8E
TXD				  BIT	      B1
WR				  BIT	      B6
